---
title: "Assignment 5: Data Visualization"
author: "Nusrat Noor"
date: "Fall 2023"
output: pdf_document
geometry: margin=2.54cm
fig_height: 3
fig_width: 4
editor_options: 
  chunk_output_type: console
---

## OVERVIEW

This exercise accompanies the lessons in Environmental Data Analytics on Data Visualization 

## Directions
1.  Rename this file `<FirstLast>_A05_DataVisualization.Rmd` (replacing `<FirstLast>` with your first and last name).
2. Change "Student Name" on line 3 (above) with your name.
3. Work through the steps, **creating code and output** that fulfill each instruction.
4. Be sure your code is tidy; use line breaks to ensure your code fits in the knitted output.
5. Be sure to **answer the questions** in this assignment document.
6. When you have completed the assignment, **Knit** the text and code into a single PDF file.

---

## Set up your session 

1. Set up your session. Load the tidyverse, lubridate, here & cowplot packages, and verify your home directory. Read in the NTL-LTER processed data files for nutrients and chemistry/physics for Peter and Paul Lakes (use the tidy `NTL-LTER_Lake_Chemistry_Nutrients_PeterPaul_Processed.csv` version in the Processed_KEY folder) and the processed data file for the Niwot Ridge litter dataset (use the `NEON_NIWO_Litter_mass_trap_Processed.csv` version, again from the Processed_KEY folder). 

2. Make sure R is reading dates as date format; if not change the format to date.

```{r initialize project}
#1 
#install.packages("tidyverse")
#install.packages("lubridate")
#install.packages("here")
#install.packages("cowplot")

#loading packages
library(tidyverse)
library(lubridate)
library(here)
library(cowplot)

here() #checked home directory

Lake <- read.csv(here(
  "./Data/Processed_KEY/NTL-LTER_Lake_Chemistry_Nutrients_PeterPaul_Processed.csv"), 
                 stringsAsFactors = TRUE)
#loaded Lake dataset

Litter <- read.csv(here(
  "./Data/Processed_KEY/NEON_NIWO_Litter_mass_trap_Processed.csv"), 
                   stringsAsFactors = TRUE)
#loaded Litter dataset

#2 
str(Lake) #checked structure of dataset to see date format (it was not date format)
Lake$sampledate <- ymd(Lake$sampledate) #changed format to date

str(Litter) #checked structure of dataset to see date format (it was not date format)
Litter$collectDate <- ymd(Litter$collectDate) #changed format to date

```
## Define your theme
3. Build a theme and set it as your default theme. Customize the look of at least two of the following: 
 * Plot background
 * Plot title
 * Axis labels
 * Axis ticks/gridlines
 * Legend

```{r build plot theme}
#3

my_theme <- theme_classic() + 
  theme(axis.title = element_text(color = "black"), #made axis titles black
        plot.background = element_rect(color = "gray"), #made plot background gray
        axis.text = element_text(color = "black"), #made axis text black
        legend.position = "right") #set legend position to the right of plot
#set theme
theme_set(my_theme)
```

## Create graphs
For numbers 4-7, create ggplot graphs and adjust aesthetics to follow best practices for data visualization. Ensure your theme, color palettes, axes, and additional aesthetics are edited accordingly.

4. [NTL-LTER] Plot total phosphorus (`tp_ug`) by phosphate (`po4`), with separate aesthetics for Peter and Paul lakes. Add a line of best fit and color it black. Adjust your axes to hide extreme values (hint: change the limits using `xlim()` and/or `ylim()`).

```{r plot total P vs PO4}
#4 

LakePlot <- ggplot(Lake, aes(x = po4, y = tp_ug, color = lakename)) + 
  #created plot for total phosphorus and phosphate
  geom_point(na.rm = TRUE) + #got rid of NAs 
  geom_smooth(method = "lm", se = FALSE, color = "black") + 
  #added a best fit line and made it black
  xlim(c(0, 50)) + #set limits for x-axis
  ylim(c(0, 150)) + #set limits for y-axis
  labs(x = "Phosphate (ug)", y = "Total Phosphorus (ug)", title = "Total Phosphorus by Phosphate", 
       color = "Lake Name") #changed labels

LakePlot #called back the plot

```


5. [NTL-LTER] Make three separate boxplots of (a) temperature, (b) TP, and (c) TN, with month as the x axis and lake as a color aesthetic. Then, create a cowplot that combines the three graphs. Make sure that only one legend is present and that graph axes are aligned. 

Tip:
* Recall the discussion on factors in the previous section as it may be helpful here. 
* R has a built-in variable called `month.abb` that returns a list of months;see <https://r-lang.com/month-abb-in-r-with-example>

```{r Create boxplots}
#5 

temp_plot <- ggplot(Lake, aes(x = month.abb[month], y = temperature_C, color = lakename)) +
  geom_boxplot() + #made boxplot of temperatures by date collected and separated by lakename
  scale_x_discrete(limits = month.abb) + #made x-axis labels show every month in abbreviated form
  labs(x = "Month", y = "Temperature(C)", title = "Temperature by Month", color = "Lake Name") 
#changed labels
print(temp_plot) #called back plot

TP_plot <- ggplot(Lake, aes(x = month.abb[month], y = tp_ug, color = lakename)) +
  geom_boxplot() + #created boxplot of total phosphorus by month and separated by lakename
  scale_x_discrete(limits = month.abb) + #made x-axis labels show every month in abbreviated form
  labs(x = "Month", y = "Total Phosphorus(ug)", title = "Total Phosphorus by Month",
       color = "Lake Name") #changed labels
print(TP_plot) #called back the plot

TN_plot <- ggplot(Lake, aes(x = month.abb[month], y = tn_ug, color = lakename)) +
  geom_boxplot() + #created boxplot of total nitrogen by month and separated by lakename
  scale_x_discrete(limits = month.abb) + ##made x-axis labels show every month in abbreviated form
  labs(x = "Month", y = "Total Nitrogen(ug)", title = "Total Nitrogen by Month", color = "Lake Name") 
#changed labels
print(TN_plot) #called back plot

#created cowplot of all three above plots
plot_all <- plot_grid(
  temp_plot + theme(legend.position = "none"), #got rid of legend
  TP_plot + theme(legend.position = "none"), #got rid of legend
  TN_plot + theme(legend.position = "bottom"), #got rid of legend
  nrow = 3, align = 'h') + 
  #set number of rows, aligned horizontally
  theme(axis.text = element_text(size = 10)) #changed axis text to size 10

plot_all #called back the plot

```

Question: What do you observe about the variables of interest over seasons and between lakes? 

> Answer: 
I notice that warmer months have higher levels of total phosphorus and total nitrogen and also have a wider spread. The average total nitrogen and phosphorus levels in Peter lake is higher and overall, has more spread. 

6. [Niwot Ridge] Plot a subset of the litter dataset by displaying only the "Needles" functional group. Plot the dry mass of needle litter by date and separate by NLCD class with a color aesthetic. (no need to adjust the name of each land use)

7. [Niwot Ridge] Now, plot the same plot but with NLCD classes separated into three facets rather than separated by color. 

```{r Plot litter}
#6
Needles1 <- ggplot(subset(Litter, functionalGroup == "Needles"), 
                   aes(x = collectDate, y = dryMass, color = nlcdClass)) +
  geom_point() + #plotted a subset of only Needles, set axis, and separated by ncld class
  labs(x = "Date", y = "Dry Mass (g)", title = "Dry Mass of Needles by Date", color = "NLCD Class") 
#changed labels 
print(Needles1) #called back the plot

#7
Needles2 <- ggplot(subset(Litter, functionalGroup == "Needles"), aes(x = collectDate, y = dryMass)) +
  geom_point() + #plotted a subset of only Needles and set axis
  facet_wrap(vars(nlcdClass), ncol = 3) + #separated the ncld classes into three facets 
  labs(x = "Date", y = "Dry Mass (g)", title = "Dry Mass of Needles by Date") 
#changed labels and title
print(Needles2) #called out the plot

```
Question: Which of these plots (6 vs. 7) do you think is more effective, and why? 

> Answer:
Plot 7 is  more effective because it separates the data much more clearly so that the points not overlapping  as much as they are in plot 6. 